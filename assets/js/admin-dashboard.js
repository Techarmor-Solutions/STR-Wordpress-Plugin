(()=>{"use strict";var e={n:s=>{var t=s&&s.__esModule?()=>s.default:()=>s;return e.d(t,{a:t}),t},d:(s,t)=>{for(var a in t)e.o(t,a)&&!e.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:t[a]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.element,t=window.wp.apiFetch;var a=e.n(t);const r=window.ReactJSXRuntime,{apiUrl:n}=window.strAdminData||{},i={available:"#22c55e",booked:"#ef4444",blocked:"#f97316"},c={available:"Available",booked:"Booked",blocked:"Blocked (external)"};function l({propertyId:e}){const t=new Date,[l,d]=(0,s.useState)(t.getFullYear()),[o,m]=(0,s.useState)(t.getMonth()+1),[p,h]=(0,s.useState)([]),[u,y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{e&&async function(){y(!0);try{const s=await a()({url:`${n}/admin/availability/${e}?year=${l}&month=${o}`,method:"GET"});h(Array.isArray(s)?s:[])}catch(e){}finally{y(!1)}}()},[e,l,o]);const j={};p.forEach(e=>{j[e.date]=e.status});const x=new Date(l,o-1,1).getDay(),v=new Date(l,o,0).getDate(),g=new Date(l,o-1).toLocaleString("default",{month:"long",year:"numeric"});return e?(0,r.jsxs)("div",{className:"str-booking-calendar",children:[(0,r.jsxs)("div",{className:"str-cal-header",children:[(0,r.jsx)("button",{onClick:function(){1===o?(m(12),d(l-1)):m(o-1)},children:"‹"}),(0,r.jsx)("h4",{children:g}),(0,r.jsx)("button",{onClick:function(){12===o?(m(1),d(l+1)):m(o+1)},children:"›"})]}),u?(0,r.jsx)("p",{children:"Loading..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"str-cal-grid str-cal-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,r.jsx)("div",{className:"str-cal-weekday",children:e},e))}),(0,r.jsxs)("div",{className:"str-cal-grid str-cal-days",children:[Array.from({length:x}).map((e,s)=>(0,r.jsx)("div",{className:"str-cal-day str-cal-empty"},`empty-${s}`)),Array.from({length:v},(e,s)=>s+1).map(e=>{const s=`${l}-${String(o).padStart(2,"0")}-${String(e).padStart(2,"0")}`,t=j[s]||"available";return(0,r.jsx)("div",{className:`str-cal-day str-cal-status-${t}`,title:c[t]||t,style:{backgroundColor:i[t]||"#e5e7eb"},children:e},e)})]}),(0,r.jsx)("div",{className:"str-cal-legend",children:Object.entries(c).map(([e,s])=>(0,r.jsxs)("span",{className:"str-cal-legend-item",children:[(0,r.jsx)("span",{className:"str-cal-legend-dot",style:{backgroundColor:i[e]}}),s]},e))})]})]}):(0,r.jsx)("p",{children:"Select a property to view its calendar."})}const{adminUrl:d}=window.strAdminData||{};function o(){const[e,t]=(0,s.useState)([]),[n,i]=(0,s.useState)(null),[c,o]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{!async function(){try{const e=await a()({path:"/wp/v2/str_property?per_page=100&status=publish",method:"GET"});t(Array.isArray(e)?e:[]),e?.length>0&&i(e[0].id)}catch(e){}finally{o(!1)}}()},[]),c?(0,r.jsx)("p",{children:"Loading properties..."}):0===e.length?(0,r.jsxs)("div",{className:"str-no-properties",children:[(0,r.jsx)("p",{children:"No properties found."}),(0,r.jsx)("a",{href:`${d}post-new.php?post_type=str_property`,className:"str-admin-btn",children:"Add Your First Property"})]}):(0,r.jsxs)("div",{className:"str-property-section",children:[(0,r.jsx)("h3",{children:"Properties"}),(0,r.jsx)("div",{className:"str-property-tabs",children:e.map(e=>(0,r.jsx)("button",{className:"str-property-tab "+(n===e.id?"is-active":""),onClick:()=>i(e.id),children:e.title?.rendered||`Property #${e.id}`},e.id))}),n&&(0,r.jsxs)("div",{className:"str-property-detail",children:[(0,r.jsx)("div",{className:"str-property-actions",children:(0,r.jsx)("a",{href:`${d}post.php?post=${n}&action=edit`,className:"str-admin-btn str-admin-btn-sm",children:"Edit Property"})}),(0,r.jsx)(l,{propertyId:n})]})]})}const{apiUrl:m,nonce:p,currency:h,adminUrl:u}=window.strAdminData||{};function y(){const[e,t]=(0,s.useState)(null),[n,i]=(0,s.useState)(!0),[c,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{!async function(){try{const e=await a()({url:`${m}/admin/metrics`,method:"GET"});t(e)}catch(e){l("Failed to load metrics.")}finally{i(!1)}}()},[]),n?(0,r.jsx)("div",{className:"str-admin-loading",children:"Loading dashboard..."}):c?(0,r.jsx)("div",{className:"str-admin-error",children:c}):(0,r.jsxs)("div",{className:"str-admin-dashboard",children:[(0,r.jsxs)("div",{className:"str-metrics-grid",children:[(0,r.jsxs)("div",{className:"str-metric-card",children:[(0,r.jsx)("div",{className:"str-metric-value",children:e?.confirmed_bookings??0}),(0,r.jsx)("div",{className:"str-metric-label",children:"Confirmed Bookings"})]}),(0,r.jsxs)("div",{className:"str-metric-card",children:[(0,r.jsx)("div",{className:"str-metric-value",children:e?.pending_bookings??0}),(0,r.jsx)("div",{className:"str-metric-label",children:"Pending Bookings"})]}),(0,r.jsxs)("div",{className:"str-metric-card",children:[(0,r.jsx)("div",{className:"str-metric-value",children:(d=e?.total_revenue??0,new Intl.NumberFormat("en-US",{style:"currency",currency:(h||"usd").toUpperCase()}).format(d))}),(0,r.jsx)("div",{className:"str-metric-label",children:"Total Revenue"})]})]}),(0,r.jsxs)("div",{className:"str-admin-actions",children:[(0,r.jsx)("a",{href:`${u}edit.php?post_type=str_property`,className:"str-admin-btn",children:"Manage Properties"}),(0,r.jsx)("a",{href:`${u}edit.php?post_type=str_booking`,className:"str-admin-btn",children:"View All Bookings"}),(0,r.jsx)("a",{href:`${u}admin.php?page=str-booking-settings`,className:"str-admin-btn",children:"Settings"})]}),(0,r.jsx)(o,{})]});var d}p&&a().use(a().createNonceMiddleware(p));const j=document.getElementById("str-admin-dashboard");j&&(0,s.render)((0,r.jsx)(y,{}),j)})();